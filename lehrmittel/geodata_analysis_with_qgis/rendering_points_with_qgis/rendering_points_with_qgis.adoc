= Rendering Points: Displaying Points as Point Cluster, by Displacement and as Heatmap
OpenSchoolMaps.ch -- Free learning materials on free geodata and maps
:xrefstyle: short
:imagesdir: ../../../bilder/rendering_points_with_qgis/
:experimental:
include::../../../snippets/suppress_title_page.adoc[]

NOTE: In this worksheet you will learn how to use different point rendering techniques of QGIS to overcome problems that points can pose.

== Objectives

This worksheet shows how you can use specific point rendering techniques in order to overcome various map challenges that involve points. We will be using different point renderers offered by QGIS in order to demonstrate how such challenges can be obstacled.

This exercise will be using data consisting of the castles of Switzerland (archeological sites, fortifications, towers inc.) in order to demonstrate some point rendering techniques. +
It will be explaining and demonstrating some of the key QGIS point rendering techniques: 

* Using the Point Cluster Renderer
* Generating Heatmaps
* Using the Point Displacement Renderer 

After completing this worksheet, you will be able to:

* Understand what challenges points can pose and how to overcome those challenges
* Use key point rendering techniques efficiently using QGIS
* Understand which point rendering techniques solve which problems

== Introduction
Most objects in the real world can be displayed as points, however, points can pose a lot of challenges. These challenges can be of different natures and must be tackled somehow by using specific techniques and renderers. In this worksheet, we will be describing and explaining some of the key QGIS renderers that solve a major set of point challenges.

In this worksheet, we took a special example of all the historical sites in Switzerland such as: castles, towers, archeological sites, forts etc. This is a neat example to demonstrate what points are and what rendering techniques can be used to overcome the problems that they can possess.

This worksheet includes:

* What are points and what problems can they pose?
* Point Cluster Renderer
* Generating Heatmaps from points
* Point Displacement Renderer

.A set(layer) of points on top of a map in QGIS
image::qgis_points.png[QGIS and a points layer]

== Prerequisites
In order to understand and complete this worksheet, you need the following prerequisites:

* QGIS environment (tested with QGIS 3.10.1-A Coru√±a)
* Data:
** `castles.geojson` file

After that's in place, we will load the necessary data into QGIS and start using and explaining some of the point rendering techniques offered by QGIS.

=== Data
The geodata used for this worksheet is in the _.geojson_ format and it's taken from the OSM overpass web tool (_overpass-turbo.osm.ch_), which is a very straightforward process for retrieving these types of geodata.

This data is taken directly from OpenStreetMap and all of the tags of the found objects is also copied to the file, including the coordinates for that OpenStreetMap object. QGIS is able to read _.geojson_ files and process them into the map. 

NOTE: To view the query for the OSM data in the _.geojson_ file using Overpass Turbo, you can use the following link: https://osm.li/3FH

A _.geojson_ file looks something like this:

[source, json]
----
include::data/castles.geojson[lines=5..35]
----
NOTE: More information on the _.geojson_ file extension can be found here: https://geojson.org/

=== Setting Up
This worksheet uses the _learn as you go_ technique for teaching, therefore, everything needs to be correctly set up before proceeding to the worksheet's main portion.

For setting up the environment and QGIS, you need to:

1. Open QGIS and make sure that no existing project is open. 
2. Load the _castles.geojson_ file (or export it manually using overpass turbo: https://osm.li/3FH) into QGIS using the drag and drop technique.
3. Choose a map background layer so that we can see where the points are located in the world map and you are ready to go!

== Point Rendering Techniques
QGIS offers some very useful point rendering techniques. Such techniques are mainly used for dealing with limited space on screen and for allowing us to distinguish different points between each other in small spaces. They are also used for letting us know which areas are more frequented than others, which are more active etc.

=== Point Cluster Renderer
One of the most important point rendering techniques is: _Point Cluster Renderer_. What this technique does is replace the points that are close to each other with a single symbol. The parameter for defining how close the points should be to be converted to a cluster can be tweaked.

This allows us to view a lot of points in a neater way. Depending on the nature of the objects in the map, clustering can help us distinguish the points locations in a more elegant and "explanatory" way.

Clustering is a very familiar concept in data and is widely used in maps, machine learning algorithms, data visualization etc.

NOTE: Play around with the _distance_ parameter in the QGIS rendering options and see what difference it makes.

Here's how some points look after applying the point displacement rendering technique: 

.Castles of Switzerland after applying the point cluster rendering technique
image::point_cluster_map.png[Point Cluster technique]

QGIS also offers us a few options for this rendering technique. These allow us to modify the:

* Cluster symbol
* Distance for triggering the clustering
* Renderer type etc.

.Point cluster options offered by QGIS
image::point_cluster_options.png[Point cluster options, 350] 

=== Generating Heatmaps
Another important rendering technique is rendering points as a heatmap. This technique is one of the best visualization tools for dense point data. It is useful in determining the density of the input objects. A heatmap rendering technique is most useful when we want to identify clusters of points where there's a high density. They can be useful for a lot of scenarios such as: finding hotspots of crime, traffic incidents, housing density, other types of crime data etc.

We will be using the same map features as before to demonstrate the heatmap rendering technique (castles and towers of Switzerland).

NOTE: Play around with the _radius_ parameter in the QGIS rendering options and see what difference it makes.

.Heatmap generated from the map features
image::heatmap_generation_map.png[Heatmap generation technique]

After generating the heatmap, a few options are displayed in QGIS.
These options allow us to set the: 

* Color of the heatmap and of the background
* Quality of the heatmap rendering
* Maximum value
* How to weigh points etc.

.Heatmap generation options offered by QGIS
image::heatmap_generation_options.png[Heatmap generation options, 350]

=== Bonus: Point Displacement Renderer
Another important point rendering technique is called: _Point Displacement Renderer_. This rendering technique allows you to cartographically shift overlapping points.

What this rendering technique actually does is just move all of the overlapping points in the map view so that they can all become visible.

Suppose we have a lot of points within a map layer. If we zoom out the map layer, it would mean that a lot of points are located on top of each other (overlapping). In order to make all of the points visible, some technique must be used in order to tackle this problem. Here's when point displacement technique comes in. It takes all of the points and analyzes where they're located in the map view and then places shifts them and places symbols around them to denote where the point actually belongs to.

.Castles of Switzerland after applying the point displacement rendering technique
image::point_displacement_map.PNG[Point displacement technique]

.An example of how overlapping points are rendered with a center symbol after using points displacement
image::point_displacement_example.png[Point displacement example, 250] 


The point displacement renderer also offers us a few options. +
With these options, we can set the:

* Center symbol shape/color
* Renderer mode for the points
* Distance to shift the overlapping points
* Placement method
* Displacement line shape/color
* Labels etc.

.Point displacement options offered by QGIS
image::point_displacement_options.png[Point displacement options, 350] 

<<<

== Exercises
In the exercise section, we are going to use a different set of data in order for you to get a better understanding on how points work and how these rendering techniques can help to tackle some point problems.

We are going to use table tennis data from all over Switzerland.

=== Preparation: Requirements before starting the exercises
1. Create a new empty QGIS project.
2. Load the _table_tennis.geojson_ file (or export it manually using overpass turbo: https://osm.li/5XH) into QGIS using the drag and drop technique.
3. Choose a map background layer so that we can see where the points are located in the world map.

=== Exercise
Play around with all of the point rendering techniques mentioned in the main portion of the worksheet and answer the following questions: 

1. Find out clusters of table tennis areas in Switzerland.
2. Generate a heatmap in order to find out the hotspots of table tennis pitches around Switzerland.
3. Find out which city of Switzerland is mostly crowded with table tennis pitches.

== Some other data sets
Some other data sets that can be used to demonstrate how points work and also the different QGIS point rendering techniques:

* Soccer pitches in Switzerland: https://osm.li/BYH
* Basketball courts in Switzerland: https://osm.li/CYH
* Night clubs in Switzerland: https://osm.li/DYH
* Tourist attractions in Switzerland: https://osm.li/GYH

IMPORTANT: All of the above data sets can also be exported into _.geojson_ files using the _Export_ button in _Overpass Turbo_. They can then be loaded into QGIS using drag and drop.

<<<
    
== Conclusion 
With this worksheet, you have learned how points look like in the map and how we can use different point rendering techniques to tackle specific problems that points can pose.

Every one of the point rendering techniques solves a specific set problems, there is no point rendering techniques that solves all of the point problems (No Free Lunch Theorem). This means that you should carefully choose which technique you decide to use to tackle point problems.

== Notes
More questions? Contact OpenStreetMap Switzerland (info@osm.ch) or Stefan Keller (stefan.keller@ost.ch)!