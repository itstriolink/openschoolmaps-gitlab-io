= Introduction to QGIS 3: What is Geodata? (Chapter 2)
OpenSchoolMaps.ch -- Freie Lernmaterialien zu freien Geodaten und Karten
:xrefstyle: short
:imagesdir: ../../../bilder/
include::../../../snippets/lang/de.adoc[]
include::../../../snippets/suppress_title_page.adoc[]

*A worksheet*
ifdef::show_solutions[- *LÖSUNGEN*]

== Geodata and spatial reference

In the last chapter you learned
that the data presented in a GIS
is spatial data. These spatial 
data are often called geodata.

image:einfuehrung_in_qgis/ausrufezeichen.png[Exclamation mark, 15, 15]
_Task 1_ +
_As an introduction to this chapter, 
consider what the terms geodata and 
spatial might mean. Think also of other
words with the prefix Geo (e.g. geography,
geology etc.). Do not look up the words
on the Internet or in a lexicon. Write
your thoughts on your worksheet._

ifdef::show_solutions[]
====
.Solution
Compare your solution with the theory in the first part of this chapter.
====
endif::show_solutions[]

=== Learning objectives of the theory

After this chapter, you will be able to:

* Explain the terms "geodata" and 
"spatial reference" in their own words
* Distinguish raster data
from vector data
* Explain the benefits of 
coordinate systems

=== Theory

==== Geodata

The prefix geo comes from Greek and 
means earth. Geodata must therefore
be data that is related to the earth.

==== Spatial reference

A spatial reference can be interpreted
in such a way that an object can be 
assigned to a place on earth. There are
two different types of spatial reference.
If the spatial reference is indicated by
measured two- or three-dimensional
coordinates, for example in the official
cadastral survey, then one speaks of a direct
spatial reference. In the area of official
statistics, however, the coordinates for 
positioning information in space do not have
to be so precise. There, the information is
often linked to generalised administrative
boundaries such as cantonal borders. In such 
a case, the term indirect spatial
reference is used.

Imagine you have a mobile phone or a camera
with a built-in GPS, which you can use to
determine the position where you are standing.
If you now take a photo, the coordinates at
which you took the photo can be saved in the
digital image. So the photo has a spatial reference.

==== Georeferencing

Objects without a room reference can often
be assigned a direct or indirect room reference.
This process is called georeferencing. Of course,
the spatial reference always refers to an earth 
image, i.e. a coordinate system. These coordinate 
systems were introduced in order to be able to 
indicate the geographical position of a place on 
earth in numbers. You probably know the different
coordinate systems from geography lessons. If you 
would like to refresh your knowledge in this area, 
you can do so with the help of the "Maps" guide 
program. This guide is available on the EducETH 
server under the link 
http://www.educ.ethz.ch/unterrichtsmaterialien/geographie-umweltlehre/karten-leitprogramm.html .

==== Type of data storage

Geodata can be stored either in the 
form of raster or vector data. What 
does this mean more precisely?

===== Raster data

When you look at digital photos on
your computer, you look at raster data.

image:einfuehrung_in_qgis/ausrufezeichen.png[Exclamation mark, 15, 15]
_Task 2_ +
_To get to know the most important properties of
a raster image,open the image Testfoto.jpg, 
which is located in the folder with the data
for this guide program, in a graphics program.
Then answer the following questions. Do not 
go any further until you have answered the questions._

* _What happens to the picture
if you keep zooming in?_
* _How are the objects displayed
in the image saved?_

//-

ifdef::show_solutions[]
====
.Solution
. If you zoom further into the image, 
you will see that at a certain zoom level
the image consists of many colored 
rectangles. The further you zoom in,
the larger these rectangles become.
. An object saved with the help
of many colored rectangles.
====
endif::show_solutions[]

Raster data can be imagined as if, for 
example, a regular grid was laid from 
above over the landscape to be displayed,
dividing the section into many equally
sized cells, also known as pixels. In 
each pixel the color value is stored, 
which best represents the underlying 
colors. The number of pixels per unit 
is also called point density or resolution.
An often used unit for dot density 
is the term dpi (dots per inch). 1 inch
corresponds to 25.4 mm. Thus, for example,
a resolution of 72 dpi means that 2.83 
dots per mm are stored. For comparison,
11.81 points per mm are saved at a 
resolution of 300 dpi.

Information can be saved for each pixel.
This can be a gray or color value as for
example with photos or pixel maps (as you
will get to know them in the exercise) or
numerical information as for example a 
measured value. Take a look at the map with
the snow depths on the homepage of the 
Institute for Snow and Avalanche Research
(SLF) as an example for grids from 
measured values: https://www.slf.ch/de.html

===== Vector data

The vector data includes, for example, 
the shapefiles you used in the first 
exercise. With vector data, the geometry
of the objects is saved as points, 
lines or areas, where one line is defined
as the connection of two points and 
one area as a closed line. Further 
information about the object, so-called
attribute data, is stored in a table 
in addition to the geometry.

===== Comparison of vector and raster data

image:einfuehrung_in_qgis/ausrufezeichen.png[Exclamation mark, 15, 15]
_Task 3_ +
_Now imagine that you want to 
represent a building in a GIS. 
Once the building is saved in
the form of raster data and once 
in the form of vector data. What
does the house edge look like with
the raster data and like with
the vector data, if you zoom 
now completely near to a house
edge? Record this on your worksheet. +
Think about which format 
(raster or vector)
needs more space._

ifdef::show_solutions[]
====
.Solution
*Raster data*

.Example for raster data (source: sketch based on an Azavea blog post 2014)
image::einfuehrung_in_qgis/rasterdaten.png["Raster data"]

*Vector data*

.Example for vector data (source: sketch based on an Azavea blog post 2014)
image::einfuehrung_in_qgis/vektordaten.png["Vector data"]

*Storage requirements* +
A value is stored for each pixel in the raster
data. For vector data, the area of the building
is saved as a closed polyline. And each 
line of this polyline is defined by two points.
Therefore, the memory requirement for
vector data is much smaller.

In order to reduce the memory requirements
for raster data, formats can be used that
compress the raster. A distinction is made
between lossy compression (e.g. jpg) 
and lossless compression (e.g. .png, .bmp).

If you want to learn more about
data compression, you can read 
the following article on Wikipedia:

https://en.wikipedia.org/wiki/Image_compression
====
endif::show_solutions[]

===== Metadata

Metadata, i.e. data about the data, 
is also always stored with the geodata.
Information about the spatial extent,
the creator, the quality etc. of the 
data can be noted in it. For example, 
if you work with data from an external 
source, you can check where the data 
comes from and whether it really 
contains what you need.

===== Web Map Services

More and more providers have data stored on
a server and offer other users excerpts from
this data as maps via special interfaces, 
so-called Web Map Services (WMS), via the 
Internet. This allows users to integrate these
maps into their GIS projects. However, it is 
important that there is always a connection to
the server on which the data is stored. For 
example, if you no longer have an Internet 
connection, the map is no longer visible in
the GIS project.

NOTE: The CRS (coordinate reference system) 
should already be set correctly in our 
given project. If you still want to 
know how to change the KBS, you can
read the following optional chapter.

==== Projections

In QGIS, projections
are usually specified 
with an EPSG code.

QGIS has some useful tools to 
search for specific projections.
QGIS can project the CRS for
a project in real time.

To change the CRS of a project, 
you can click on the EPSG code 
in the status bar and select
a new CRS. 

===== Projection of a layer

To specify a specific CRS for a 
specific layer, right-click on
the layer and move the mouse 
pointer over the _Set CRS_ menu
and select _Set Layer CRS..._. 
Then you can select the 
desired CRS.

===== Re-projecting the data

To re-project the data in your 
table, just right-click the layer
name, click _Export_ and select
_Save Feature As..._. In the
upper part of the window you
can change the CRS.

If you are not sure which EPSG 
code to use, you can look it
up at http://spatialreference.org/

== QGIS Exercise

In the theory part you learned a 
lot about vector and raster data.
In this exercise we want to create
a new GIS project and load 
vector and raster data into it.

=== Learning objectives

After this exercise you 
will be able to do the following:

* Choosing the right coordinate 
reference system for a new project
* Load vector data and WMS services into the project

=== Project settings

To open an empty project, either close and 
open QGIS again or click the New Project
button. Now you want to load geodata
into the empty project.

However, before loading data, the coordinate
system of the project should be defined.
To do this, press the _Current CRS_ button
in the lower right corner of QGIS. With the
filter you can then search for the
desired coordinate system.

The following coordinate system
is used for Switzerland:
CH1903 /LV03 (EPSG: 21781) 

Select the default system using
the search function and confirm
the setting by clicking the
Apply button.

Then go under _Project_ -> _Properties_
to the tab with the name General,
set the project title "Switzerland"
and define a background color.

Under Save paths you can choose whether
the paths should be saved relative
or absolute to the data. The advantage
of the relative paths is that you can
copy the folder with the QGIS project
and the data to another location without
having to adjust the whole paths to
the data. So choose the Relative
option for your new project.

Then close the Project Settings window by
clicking the OK button. In order for the
new background color to appear, a navigation
function such as Move map must be
executed in the map window.

=== Save project

Use the _Save Project_ button to save
your new project to the folder where
you saved the data for this exercise.

=== Import data

The card is now ready to read data.
The menu Database in the menu bar
is used for this purpose. For the 
different types of data that can
be read, it also has different buttons.

==== Read in vector data

The first step is to insert the vector data
from the first exercise. Click on the
tab GeoPackage, if you don't see the
tab introduction_in_qgis_data.gpkg, 
right-click on GeoPackage and navigate
to the tasks folder for part 1. If you 
see the database, open the tab and use 
right-click and choose Add to map to add 
canton borders and lakes to the map.

Select the cantonal borders as background for
the map overview. If you don't know exactly
how to proceed, check again in the first exercise.

What information is stored in the two layers at all?
Let's take a closer look at this. Click with the
right mouse button on the layer lakes and choose 
_Open attribute table_. The table will open with 
the thematic information about the lakes. Which 
information was saved as attribute?

image:einfuehrung_in_qgis/ausrufezeichen.png[Exclamation mark, 15, 15]
_Task 4_ +
_Take a close look at the table and
write down what data each column contains._

ifdef::show_solutions[]
====
_Solution_

.Table of the layer lakes
image::einfuehrung_in_qgis/seetable.png["Sea Table", 650, 120]

_name:_ The names of the lakes +
_type:_ the lake serves as a reservoir lake (entry reservoir lake) or not (entry lake) +
_height:_ How high is the lake in meters above sea level? +
_max_Depth:_ Deep of the lake at the deepest point in meters [m] +
_volume:_ Volume of the lake in cubic kilometres [km^3^] +
_area:_ Area of the lake in square kilometres [km^2^]
====
endif::show_solutions[]

image:einfuehrung_in_qgis/ausrufezeichen.png[Exclamation mark, 15, 15]
_Task 5_ +
_Do the same for the 
cantonal borders._

ifdef::show_solutions[]
====
_Solution_

.Table of the layer Cantons
image::einfuehrung_in_qgis/kantonetable.png["Cantons Table", 650, 120]

_Name:_ Names of the cantons +
_Abbreviation:_ canton abbreviation +
_AccessionYear:_ Year of accession to Switzerland +
_Inhabitants:_ Number of inhabitants +
_Municipalities:_ Number of municipalities +
_OfficialLanguage:_ Official languages spoken in the canton +
_Stands:_ Number of stands (0.5 = half canton) +
_Area:_ Area of the canton in square kilometres [km^2^]
====
endif::show_solutions[]

==== Read raster data

Die Rasterdaten sollen in Form
eines WMS-Layers eingelesen werden.
Weisst du noch,
was ein WMS-Layer ist?
Wenn nicht,
schaue nochmals im Theorieteil nach.

Der Bund bietet auf seiner Homepage
einen Überblick über die Verfügbaren WMS-Dienste an
(http://www.geo.admin.ch unter
Dienstleistungen -> Geodienste ->
Darstellungsdienste -> Web Map Services).

Unter dem Titel Verfügbare WMS-Dienste
sind unter GetCapabilities die Anfragen
in Form von Links abgespeichert.
Wenn du z.B. auf den Link
http://wms.geo.admin.ch/?REQUEST=GetCapabilities&SERVICE=WMS&VERSION=1.0.0&lang=de
klickst,
wird eine Anfrage an den Server
http://wms.geo.admin.ch/
gestartet und du erhältst
als Antwort eine Auflistung
der verfügbaren WMS-Services.

Unter _Title_ findest du den Titel
des WMS-Services und unter _Abstract_
einen kurzen Beschrieb,
was genau in den Daten abgespeichert ist.
Zusätzlich sind auch Informationen
über die Ausdehnung
und die möglichen Koordinatensysteme
erhältlich.

Aus diesen Daten möchten wir
die Übersichtskarte
in unser Projekt einbinden.
Wähle im Werkzeugkasten
_Manage Layers_
das Werkzeug _Add WMS/WMTS Layer_.
Wenn du im Reiter _Layers_
beim obersten Balken
auf den Pfeil klickst,
siehst du,
dass bereits einige Server
standardmässig eingebunden sind.
Um den Server
mit den öffentlichen Daten
der _Bundes Geodaten-Infrastruktur_ (BGDI)
ebenfalls einzubinden,
muss eine neue WMS-Verbindung
erstellt werden.
Dazu muss auf den _New_-Button
geklickt werden.
Gib im Fenster _Create a New WMS/WMTS Connection_
den Namen der Verbindung an (z.B. WMS-BGDI)
und die URL zum gewünschten Server
(in unserem Fall http://wms.geo.admin.ch/).
Benutzername und Passwort werden
in diesem Fall nicht gebraucht.

Wenn du jetzt nochmals auf den Pfeil
des ersten Balkens klickst,
sollte die neu angelegte Verbindung
ebenfalls erscheinen.
Wähle diese aus
und klicke auf _Connect_.

Nun werden alle WMS-Dienste angezeigt,
die auf dem Server der BGDI
öffentlich angeboten werden.
Klicke auf die _Übersichtskarte Hydrogeologie_
und wähle als Layername „Übersichtskarte“
und ändere das Koordinatenbezugssystem
von WGS 84 auf das schweizerische
Bezugssystem CH1903 / LV03.
Am einfachsten wählst du
den Filter aus
und gibst als Text CH1903 ein.
So erscheint das gewünschte System
in der Auswahl.
Anschliessend können der WMS-Layer hinzugefügt
und das Fenster geschlossen werden.

Damit die Übersichtskarte im Kartenfenster
nicht die Kantonsgrenzen und Seen überdeckt,
muss die Layerreihenfolge angepasst werden.
Denke dir eine geeignete Reihenfolge aus
und wende sie an.

==== Vergleich zwischen Raster- und Vektordaten

Zum Schluss dieser Übung
sollst du dir die Unterschiede
zwischen Vektor- und Rasterdaten
nochmals etwas genauer anschauen.

image:einfuehrung_in_qgis/ausrufezeichen.png[, 15, 15]
_Aufgabe 6_ +
_Blende dazu den Layer mit den Kantonsgrenzen aus
und zoome zu einem beliebigen See.
Zoome am Uferbereich immer weiter hinein
und beobachte,
was mit den Seegrenzen bei den Vektor-
und den Rasterdaten passiert
und welches die Unterschiede sind.
Wenn nicht beide Grenzen sichtbar sind,
kannst du die Seen ein- und ausblenden,
um auch die Rasterdaten
unter dem See-Layer zu sehen.
Schreibe deine Beobachtungen
in eigenen Worten auf._

ifdef::show_solutions[]
====
.Lösung
Bei den Rasterdaten besteht die Seegrenze aus
blauen Pixeln und bei den Vektordaten aus Linien.
====
endif::show_solutions[]

Speichere dein Projekt ab.
In der nächsten Übung wirst du
mit dem gleichen Projekt weiterarbeiten.
Aber vorher musst du noch den Kapiteltest bestehen.

== Kapiteltest 2

Schon ist es wieder soweit.
Du bist wieder bei einem Kapiteltest angelangt.
Lege wieder alle Unterlagen weg,
ausser einem Blatt Papier und einem Stift.
Hier die Fragen zum Kapitel 2:

=== Frage 1

Du möchtest in deinem GIS eine Mauer darstellen,
welche aus der Luft gesehen so aussieht,
als würden sich zwei Linien
in einem Winkel von 135 Grad treffen.

_Wie sieht die Darstellung aus, wenn du_

. das Rasterformat
. das Vektorformat

_als Speicherformat wählst?
Was wird bei den einzelnen Formaten
von der Mauer abgespeichert?_

Beantworte die Fragen in eigenen Worten.
Erstelle zusätzlich zur Beschreibung
je eine Skizze der Mauer
im Raster- und Vektorformat.

ifdef::show_solutions[]
====
.Lösung
Rasterformat speichert die Raster-Punkte, über
die die Mauer läuft. +
Vektorformat speichert Anfang- und Endpunkt der Mauer und den Punkt,
an dem die Mauer eine Ecke macht.
====
endif::show_solutions[]

=== Frage 2

Im Kapitel 2 war oft von Geodaten die Rede.

_Was bedeutet der Begriff Geodaten?
Welches ist der Unterschied zwischen
Geodaten und anderen Daten?_

Beantworte die Fragen so,
dass sie auch
von einem GIS-Laien verstanden werden.
Verzichte also auf Fachbegriffe.

ifdef::show_solutions[]
====
.Lösung
Geodaten sind Daten, die einen Raumbezug haben,
die sich also auf bestimme Orte oder Gebiete beziehen.
====
endif::show_solutions[]

=== Frage 3

Im Übungsteil hast du neben Vektordaten
auch einen WMS-Layer in dein Projekt geladen.

Welches ist der Unterschied
zwischen dem Vektordaten-Layer
und dem WMS-Layer bezüglich:

* Format
* Speicherort
* Verfügbarkeit

Schreibe zu jedem Punkt
mindestens einen Satz.

ifdef::show_solutions[]
====
.Lösung
*Format* +
Der Vektor-Layer nutzt Vektordaten
im Gegensatz zu den Rasterdaten des WMS-Layers.

*Speicherort* +
Die Daten des Vektor-Layers sind lokal gespeichert,
während die des WMS-Layers auf einem Server gespeichert sind und für die Darstellung von dort abgerufen werden.

*Verfügbarkeit* +
Der WMS-Layer läuft über einen Server
und hat deshalb eine schlechtere Verfügbarkeit
als der Vektor-Layer. Auch sendet der Server die
Karte als ein einzelnes Bild, was es nochmals
verlangsamt.
====
endif::show_solutions[]
